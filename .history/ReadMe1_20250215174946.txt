Um dein System von Anfang bis Ende zu testen, mÃ¼ssen wir sicherstellen, dass alle Komponenten nacheinander funktionieren und miteinander verbunden sind. Hier ist der Schritt-fÃ¼r-Schritt-Testplan, um die gesamte Verarbeitung zu prÃ¼fen:

1ï¸âƒ£ Test: Google Vision API - ZÃ¤hlen der MÃ¼lltonnen

Ziel: PrÃ¼fen, ob die Vision API ein Bild verarbeitet und die MÃ¼lltonnen korrekt zÃ¤hlt.

Testschritte:
	1.	Stelle sicher, dass dein vision_api.py Skript mit dieser Korrektur lÃ¤uft:

import requests
import base64

API_KEY = "DEIN_API_SCHLÃœSSEL"
IMAGE_PATH = "testbild.jpg"

def vision_api(image_path):
    with open(image_path, "rb") as img:
        img_data = base64.b64encode(img.read()).decode("utf-8")  # Base64-Kodierung

    response = requests.post(
        f"https://vision.googleapis.com/v1/images:annotate?key={API_KEY}",
        json={
            "requests": [
                {
                    "image": {"content": img_data},
                    "features": [{"type": "OBJECT_LOCALIZATION"}],
                }
            ]
        },
    )

    print(response.json())

vision_api(IMAGE_PATH)


	2.	FÃ¼hre das Skript aus:

python vision_api.py


	3.	ÃœberprÃ¼fe die Ausgabe:
	â€¢	Falls MÃ¼lltonnen erkannt werden, bekommst du eine JSON-Antwort mit den Objekten.
	â€¢	Falls keine MÃ¼lltonnen erkannt werden, Ã¼berprÃ¼fe das Bild (testbild.jpg).

âœ… Wenn die MÃ¼lltonnen gezÃ¤hlt werden, gehe zum nÃ¤chsten Schritt.

2ï¸âƒ£ Test: Digitale Unterschrift speichern

Ziel: PrÃ¼fen, ob die Unterschrift im HTML-Canvas korrekt erfasst und an den Server gesendet wird.

Testschritte:
	1.	Starte einen lokalen Webserver, um die Unterschrift aufzunehmen:

python -m http.server 8080


	2.	Ã–ffne die HTML-Seite im Browser
	â€¢	Ã–ffne http://localhost:8080/signature.html
	â€¢	Unterschreibe auf dem Canvas
	â€¢	Klicke auf â€Speichernâ€œ
	3.	Erwarte folgende Ausgabe in der Entwicklertools-Konsole (F12 â†’ Netzwerk):

{"signature": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAB4AAAAQCA..."}


	4.	Falls der Server fehlt, erstelle ihn in server.py:

from flask import Flask, request, jsonify

app = Flask(__name__)

@app.route("/save_signature", methods=["POST"])
def save_signature():
    data = request.json
    signature_data = data.get("signature")

    if signature_data:
        with open("signature.png", "wb") as f:
            import base64
            f.write(base64.b64decode(signature_data.split(",")[1]))

        return jsonify({"status": "ok"})
    return jsonify({"error": "No signature received"}), 400

if _name_ == "_main_":
    app.run(port=5000)


	5.	Starte den Server in einem neuen Terminal:

python server.py



âœ… Wenn die Unterschrift gespeichert wird (Datei signature.png erscheint), gehe zum nÃ¤chsten Schritt.

3ï¸âƒ£ Test: PDF-Generierung mit Unterschrift

Ziel: PrÃ¼fen, ob ein PDF mit gezÃ¤hlten MÃ¼lltonnen & Unterschrift erstellt wird.
	1.	Erstelle das generate_pdf.py Skript:

from reportlab.lib.pagesizes import letter
from reportlab.pdfgen import canvas
import base64
import io

def generate_pdf(adresse, tonnen_anzahl, datum, signature_base64, output_filename):
    c = canvas.Canvas(output_filename, pagesize=letter)
    c.drawString(100, 750, f"BestÃ¤tigung der MÃ¼llabholung")
    c.drawString(100, 730, f"Adresse: {adresse}")
    c.drawString(100, 710, f"Anzahl MÃ¼lltonnen: {tonnen_anzahl}")
    c.drawString(100, 690, f"Abholdatum: {datum}")

    # Unterschrift dekodieren
    signature_data = signature_base64.replace("data:image/png;base64,", "")
    signature_bytes = base64.b64decode(signature_data)
    signature_io = io.BytesIO(signature_bytes)
    
    c.drawImage(signature_io, 100, 600, width=200, height=100)
    c.showPage()
    c.save()

# Testaufruf
with open("signature.png", "rb") as f:
    signature_base64 = "data:image/png;base64," + base64.b64encode(f.read()).decode("utf-8")

generate_pdf("MusterstraÃŸe 5", 3, "2025-02-15", signature_base64, "bestÃ¤tigung.pdf")


	2.	FÃ¼hre das Skript aus:

python generate_pdf.py


	3.	ÃœberprÃ¼fe, ob bestÃ¤tigung.pdf erstellt wurde.

âœ… Wenn das PDF erzeugt wird, gehe zum nÃ¤chsten Schritt.

4ï¸âƒ£ Test: E-Mail-Versand mit PDF-Anhang

Ziel: PrÃ¼fen, ob das PDF automatisch per E-Mail verschickt wird.
	1.	Stelle sicher, dass du SMTP-Zugang hast. Falls Gmail genutzt wird:
	â€¢	Gehe zu Google Sicherheitseinstellungen
	â€¢	Erstelle ein App-Passwort fÃ¼r SMTP
	â€¢	Notiere das Passwort
	2.	Erstelle send_email.py:

import smtplib
from email.message import EmailMessage

def sende_email(empfaenger_email, pdf_pfad):
    msg = EmailMessage()
    msg["Subject"] = "BestÃ¤tigung MÃ¼llabholung"
    msg["From"] = "muellservice@example.com"
    msg["To"] = empfaenger_email
    msg.set_content("Hier ist die BestÃ¤tigung Ihrer MÃ¼llabholung.")

    with open(pdf_pfad, "rb") as f:
        msg.add_attachment(f.read(), maintype="application", subtype="pdf", filename="bestÃ¤tigung.pdf")

    with smtplib.SMTP_SSL("smtp.gmail.com", 465) as smtp:
        smtp.login("muellservice@example.com", "MEIN_APP_PASSWORT")
        smtp.send_message(msg)

sende_email("kunde@example.com", "bestÃ¤tigung.pdf")


	3.	FÃ¼hre das Skript aus:

python send_email.py


	4.	ÃœberprÃ¼fe das E-Mail-Postfach des EmpfÃ¤ngers.

âœ… Wenn das PDF per E-Mail ankommt, ist dein System erfolgreich getestet!

ğŸ”¹ Gesamt-Test-Checkliste

Test	Status
Google Vision API zÃ¤hlt Tonnen âœ…	ğŸŸ¢ LÃ¤uft
Unterschrift kann erfasst werden âœ…	ğŸŸ¢ LÃ¤uft
PDF mit Tonnenzahl & Unterschrift wird erstellt âœ…	ğŸŸ¢ LÃ¤uft
E-Mail mit PDF wird versendet âœ…	ğŸŸ¢ LÃ¤uft

ğŸš€ Letzter Schritt: Alles zusammenfÃ¼hren

Falls alles einzeln funktioniert, erstelle ein Hauptskript, das alle Module integriert.

# 1. MÃ¼lltonnen zÃ¤hlen
anzahl_tonnen = vision_api("testbild.jpg")

# 2. Unterschrift aus Datei laden
with open("signature.png", "rb") as f:
    signature_base64 = "data:image/png;base64," + base64.b64encode(f.read()).decode("utf-8")

# 3. PDF generieren
generate_pdf("MusterstraÃŸe 5", anzahl_tonnen, "2025-02-15", signature_base64, "bestÃ¤tigung.pdf")

# 4. PDF per E-Mail senden
sende_email("kunde@example.com", "bestÃ¤tigung.pdf")

âœ… Nun kannst du alles auf einmal testen! ğŸš€

Sag mir, falls du Fragen hast oder etwas optimiert werden soll! ğŸ˜Š